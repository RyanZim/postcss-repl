<div id="editor-{id}" ref:editor></div>

<script>
import CodeMirror from 'codemirror';
import 'codemirror/mode/css/css.js';

export default {
  data() {
    return {
      value: '',
    };
  },
  oncreate() {
    const commonOpts = {
      mode: 'css',
      lineNumbers: true,
      extraKeys: {
        // Soft tab support
        Tab(cm) {
          const spaces = Array(cm.getOption('indentUnit') + 1).join(' ');
          cm.replaceSelection(spaces);
        },
      },
    };

    const { id, value } = this.get();

    if (id === 'output') {
      const editor = new CodeMirror(
        document.getElementById(`editor-${id}`),
        Object.assign({ readOnly: 'nocursor' }, commonOpts)
      );
      this.on('state', ({ changed, current }) => {
        if (changed.value) editor.setValue(current.value);
      });
    } else {
      const editor = new CodeMirror(
        document.getElementById(`editor-${id}`),
        Object.assign({ value }, commonOpts)
      );
      editor.on('change', () => {
        this.set({ value: editor.getValue() });
      });
    }
  },
};
</script>

<style>
/* codemirror css is imported in app/index.css to avoid unneeded scoping */
@import '../variables.css';

/* codemirror hacks; have to use :global since they're not in the template */
:global(.CodeMirror) {
  height: 100%;
  &.cm-s-default {
    background: $gray;

    & .CodeMirror-gutters {
      background: #ddd;
    }

    & .CodeMirror-linenumber {
      color: #666;
    }
  }
}
</style>
